/**
 * prgrmr
 *
 * Programmer profile for GitHub projects
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright 2013 Jason Mulligan
 * @license BSD-3 <https://raw.github.com/avoidwork/prgrmr/master/LICENSE>
 * @link https://github.com/avoidwork/prgrmr
 * @version 0.1.0
 */
(function(e){"use strict";var t,n={blog:{},config:{},events:{},orgs:{},repos:{},templates:{},version:"0.1.0"},r={events:"https://api.github.com/users/{{user}}/events",orgs:"https://api.github.com/users/{{user}}/orgs",repos:"https://api.github.com/users/{{user}}/repos"},i=function(e){var n=t("#charts");n.removeClass("hidden")},s=function(n){var r=n.message||n;t.log(r,"error"),e.humane.error(r)},o=function(){var i=t("#contact"),o=t("header > h1")[0],u=t("title")[0],a=t("#version"),c=t("article")[0],h;e.humane.error=e.humane.spawn({addnCls:"humane-jackedup-error",timeout:3e3}),a!=="undefined"&&a.html(n.version),h=l(c,"large"),"assets/config.json".get(function(e){if(e.github.isEmpty())throw Error(t.label.error.invalidArguments);n.config=e,o.html(e.name),u.html(e.name),i.create("li").create("a",{href:"https://github.com/"+e.github,title:"GitHub"}).create("span",{"class":"icon icon-github"}),e.email.isEmail()&&i.create("li").create("a",{href:"mailto:"+e.email,title:"Email"}).create("span",{"class":"icon icon-envelope-alt"}),e.twitter.isEmpty()||i.create("li").create("a",{href:"http://twitter.com/"+e.twitter,title:"Twitter"}).create("span",{"class":"icon icon-twitter"}),e.blog.isEmpty()||i.create("li").create("a",{href:e.blog,title:"Blog"}).create("span",{"class":"icon icon-rss"}),i.childNodes.length>0&&i.parentNode.removeClass("hidden")},function(e){throw h.el.destroy(),h=null,s(e),e}).then(function(i){t.iterate(r,function(e,t){r[t]=e.replace("{{user}}",i.github)}),t.iterate(n,function(e,n){this[n]=t.data({id:n},null,{key:"id",events:!1})}),e.prgrmr=n},function(e){throw h.el.destroy(),h=null,s("Configuration is not valid: "+(e.message||e)),e}).then(function(e){f("events",h),f("orgs",h),f("repos",h)},function(e){h.el.destroy(),h=null,s("Could not consume APIs")})},u=function(e,n){n=n===!0,t.log(e),n||humane.log(e)},a=function(e){var r=t("#"+e),s;s=function(t){var r=t.find(".moment"),i,s;r.forEach(function(e){e.text(moment(e.text()).fromNow())});switch(e){case"events":i=n[e].data.get(t.data("key").toString()),t.find("> span")[0].addClass(i.data.type),t.find("a")[0].attr("title",i.data.type.replace("Event","").replace(/([A-Z])/g," $1").trim());break;case"repos":i=n[e].data.get(t.data("key").toString()),s=t.find("> a")[0],t.find("> span")[0].addClass(i.data.fork?"icon-circle-blank":"icon-circle"),s.attr("href").isEmpty()&&s.attr("href",i.data.html_url)}},n[e].datalist=t.datalist(r,n[e].data,n.templates[e],{callback:s}),r.removeClass("hidden"),i(e)},f=function(e,i){var o=t.promise();return n[e].data.setUri(r[e]).then(function(){("templates/"+e+".html").get(function(t){n.templates[e]=t,i!==null&&(i.el.destroy(),i=null),a(e),n[e].setExpires(300),o.resolve(!0)},function(e){o.reject(e),s(e)})},function(e){i!==null&&(i.el.destroy(),i=null),o.reject(e),s(e)}),o},l=function(e,n){e=t.object(e),n=n||"small";var r,i;i={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#000",speed:1,trail:70,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};switch(n){case"small":i.length=4,i.radius=4,i.width=2;break;case"medium":i.length=7,i.radius=7,i.width=3;break;case"large":default:i.length=12,i.radius=12,i.width=3}return(new Spinner(i)).spin(e)},c=function(e,n){var r=t.promise();return utility.defer(function(){var e={};r.resolve(e)}),r};typeof abaaso!="undefined"&&(t=e[abaaso.aliased],t.on("render",function(){o()}))})(this);