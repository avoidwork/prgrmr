/**
 * prgrmr
 *
 * Single page JavaScript dashboard of a Programmer's activity on GitHub
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright 2013 Jason Mulligan
 * @license BSD-3 <https://raw.github.com/avoidwork/prgrmr/master/LICENSE>
 * @link https://github.com/avoidwork/prgrmr
 * @version 0.1.13
 */
(function(e){"use strict";var t=["#FF0000","#FF7400","#009999","#00CC00","#FFF141","#A1F73F","#FFBB00","#A7A500","#7B005D","#450070","#5F15F6","#EA0043","#2AF000","#41D988","#3FA9CD","#046889","#F09C45","#7BB000"],n=["CommitCommentEvent","CreateEvent","DeleteEvent","DownloadEvent","FollowEvent","ForkEvent","ForkApplyEvent","GistEvent","GollumEvent","IssueCommentEvent","IssuesEvent","MemberEvent","PublicEvent","PullRequestEvent","PullRequestReviewCommentEvent","PushEvent","TeamAddEvent","WatchEvent"],r={config:{},events:{},orgs:{},repos:{},me:{},templates:{},version:"0.1.13"},i={events:"https://api.github.com/users/{{user}}/events?callback=?",me:"https://api.github.com/users/{{user}}?callback=?",orgs:"https://api.github.com/users/{{user}}/orgs?callback=?",repos:"https://api.github.com/users/{{user}}/repos?callback=?"},s=function(t,n,r,i,s){s=s||d3.scale.category10().range();var o=i.id,u;e("#charts").removeClass("hidden"),i.parentNode.prepend("h2").text(n);switch(t){case"pie":u=function(){var e=nv.models.pieChart().x(function(e){return e.key}).y(function(e){return e.y}).values(function(e){return e}).tooltipContent(function(e,t,n,r){return"<h3>"+e+"</h3>"+"<span>"+t+"%</span>"}).color(s).showLabels(!1);return d3.select("#"+o).datum(r).transition().duration(1200).call(e),e}}return nv.addGraph(u)},o=function(t){var n=t.message||t;e.log(n,"error"),window.humane.error(n)},u=function(){var t=e("#version"),n=e("article")[0],s={key:"id",events:!1,callback:"callback",source:"data"},u;window.humane.error=window.humane.spawn({addnCls:"humane-jackedup-error",timeout:3e3}),t!=="undefined"&&t.html(r.version),u=h(n,"large"),"assets/config.json".get(function(t){if(t.github.isEmpty())throw Error(e.label.error.invalidArguments);r.config=t},function(e){throw u.el.destroy(),u=null,o(e),e}).then(function(t){e.iterate(i,function(n,o){i[o]=n.replace("{{user}}",t.github),r[o]=e.data({id:o},null,s)}),window.prgrmr=r},function(e){throw u!==null&&(u.el.destroy(),u=null),o("Configuration is not valid: "+(e.message||e)),e}).then(function(t){c("me").then(function(n){var i=n[0],s=e("#contact"),a=e("header > h1")[0],h=e("title")[0];t.name&&(a.html(i.data.name),h.html(i.data.name)),s.create("li").create("a",{"class":"github",href:"https://github.com/"+t.github,title:"GitHub"}).create("span",{"class":"icon icon-github"}),t.email&&i.data.email!==null&&s.create("li").create("a",{"class":"email",href:"mailto:"+i.data.email,title:"Email"}).create("span",{"class":"icon icon-envelope-alt"}),t.gplus.isEmpty()||s.create("li").create("a",{"class":"gplus",href:"https://plus.google.com/"+t.gplus,title:"Google Plus"}).create("span",{"class":"icon icon-google-plus"}),t.twitter.isEmpty()||s.create("li").create("a",{"class":"twitter",href:"http://twitter.com/"+t.twitter,title:"Twitter"}).create("span",{"class":"icon icon-twitter"}),t.linkedin.isEmpty()||s.create("li").create("a",{"class":"linkedin",href:t.linkedin,title:"LinkedIn"}).create("span",{"class":"icon icon-linkedin"}),t.blog&&i.data.blog!==null&&s.create("li").create("a",{"class":"blog",href:i.data.blog,title:"Blog"}).create("span",{"class":"icon icon-rss"}),s.parentNode.removeClass("hidden"),u.el.destroy(),u=null,["events","orgs","repos"].forEach(function(e){try{r[e].data.restore()}catch(t){void 0}r[e].data.total>0&&f(e).then(function(){l(e)},function(e){o(e)}),c(e).then(function(){f(e).then(function(){l(e)},function(e){o(e)})},function(e){o(e)})})},function(e){u.el.destroy(),u=null,o("Could not retrieve GitHub account: "+e.message)})},function(e){o("Could not consume APIs")})},a=function(t,n){n=n===!0,e.log(t),n||humane.log(t)},f=function(e){var t=("templates/"+e+".html").get(function(t){r.templates[e]=t},function(e){throw e});return t},l=function(i){var o=e("#"+i),u,a,f,l;u=function(e){var t=e.find(".moment"),n,s;t.forEach(function(e){e.text(moment(e.text()).fromNow())});switch(i){case"events":s=r[i].data.get(e.data("key").toString()),e.find("> span")[0].addClass(s.data.type),e.find("a")[0].attr("title",s.data.type.replace("Event","").replace(/([A-Z])/g," $1").trim());break;case"repos":s=r[i].data.get(e.data("key").toString()),n=e.find("> a")[0],e.find("> span")[0].addClass(s.data.fork?"icon-circle-blank forked":"icon-circle authored"),n.attr("href").isEmpty()&&n.attr("href",s.data.html_url)}};if(r[i].data.total>0){r[i].datalist===undefined&&(r[i].datalist=e.datalist(o,r[i].data,r.templates[i],{callback:u}),o.removeClass("hidden"));switch(i){case"events":a=[],f=p("pie",r[i].data.get(),i),l=e("#recent-activities").clear(),l.parentNode.find("h2").destroy(),f[0].forEach(function(e){a.push(t[n.index(e.key.replace(/\s+/g,"")+"Event")]||t.last())}),s("pie","Recent Activities",f,l,a);break;case"orgs":break;case"repos":l=e("#repositories").clear(),l.parentNode.find("h2").destroy(),s("pie","Repositories",p("pie",r[i].data.get(),i),l,["#009999","#9FEE00"])}}},c=function(e){var t=r[e].data.setUri(i[e]).then(function(t){if(t.length===1&&t[0].data.message!==undefined)throw Error(t[0].data.message);r[e].data.save()},function(e){throw e});return t},h=function(t,n){t=e.object(t),n=n||"small";var r,i;i={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#000",speed:1,trail:70,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};switch(n){case"small":i.length=4,i.radius=4,i.width=2;break;case"medium":i.length=7,i.radius=7,i.width=3;break;case"large":default:i.length=12,i.radius=12,i.width=3}return(new Spinner(i)).spin(t)},p=function(t,n,r){var i=[],s=[],o={},u=n.length;switch(t){case"pie":r==="events"?(n.forEach(function(e){var t=e.data.type;o[t]=o[t]+1||1}),e.iterate(o,function(e,t){s.push({key:t.replace("Event","").replace(/([A-Z])/g," $1").trim(),y:e/u*100})})):r==="repos"&&(n.forEach(function(e){var t=e.data.fork?"Forked":"Authored";o[t]=o[t]+1||1}),s.push({key:"Authored",y:o.Authored/u*100}),s.push({key:"Forked",y:o.Forked/u*100})),i=[s]}return i};e.on("render",function(){u()})})(abaaso);