/**
 * prgrmr
 *
 * Single page JavaScript dashboard of a Programmer's activity on GitHub
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright 2013 Jason Mulligan
 * @license BSD-3 <https://raw.github.com/avoidwork/prgrmr/master/LICENSE>
 * @link https://github.com/avoidwork/prgrmr
 * @version 0.1.14
 */
(function(e,t){"use strict";var n=["#FF0000","#FF7400","#009999","#00CC00","#FFF141","#A1F73F","#FFBB00","#A7A500","#7B005D","#450070","#5F15F6","#EA0043","#2AF000","#41D988","#3FA9CD","#046889","#F09C45","#7BB000"],r=["CommitCommentEvent","CreateEvent","DeleteEvent","DownloadEvent","FollowEvent","ForkEvent","ForkApplyEvent","GistEvent","GollumEvent","IssueCommentEvent","IssuesEvent","MemberEvent","PublicEvent","PullRequestEvent","PullRequestReviewCommentEvent","PushEvent","TeamAddEvent","WatchEvent"],i={config:{},events:{},orgs:{},repos:{},me:{},templates:{},version:"0.1.14"},s={events:"https://api.github.com/users/{{user}}/events?callback=?",me:"https://api.github.com/users/{{user}}?callback=?",orgs:"https://api.github.com/users/{{user}}/orgs?callback=?",repos:"https://api.github.com/users/{{user}}/repos?callback=?"},o=function(t,n,r,i,s){s=s||d3.scale.category10().range();var o=i.id,u;e("#charts").removeClass("hidden"),i.parentNode.prepend("h2").text(n);switch(t){case"pie":u=function(){var e=nv.models.pieChart().x(function(e){return e.key}).y(function(e){return e.y}).values(function(e){return e}).tooltipContent(function(e,t,n,r){return"<h3>"+e+"</h3>"+"<span>"+t+"%</span>"}).color(s).showLabels(!1);return d3.select("#"+o).datum(r).transition().duration(1200).call(e),e}}return nv.addGraph(u)},u=function(n){var r=n.message||n;e.log(r,"error"),t.error(r)},a=function(){var n=e("#version"),r=e("article")[0],o={key:"id",events:!1,callback:"callback",source:"data"},a;t.error=t.spawn({addnCls:"humane-jackedup-error",timeout:3e3}),n!==undefined&&n.html(i.version),a=p(r,"large"),"assets/config.json".get(function(t){if(t.github.isEmpty())throw Error(e.label.error.invalidArguments);i.config=t},function(e){throw a.el.destroy(),a=null,u(e),e}).then(function(t){e.iterate(s,function(n,r){s[r]=n.replace("{{user}}",t.github),i[r]=e.data({id:r},null,o)}),window.prgrmr=i},function(e){throw a!==null&&(a.el.destroy(),a=null),u("Configuration is not valid: "+(e.message||e)),e}).then(function(t){h("me").then(function(n){var r=n[0],s=e("#contact"),o=e("header > h1")[0],f=e("title")[0];t.name&&(o.html(r.data.name),f.html(r.data.name)),s.create("li").create("a",{"class":"github",href:"https://github.com/"+t.github,title:"GitHub"}).create("span",{"class":"icon icon-github"}),t.email&&r.data.email!==null&&s.create("li").create("a",{"class":"email",href:"mailto:"+r.data.email,title:"Email"}).create("span",{"class":"icon icon-envelope-alt"}),t.gplus.isEmpty()||s.create("li").create("a",{"class":"gplus",href:"https://plus.google.com/"+t.gplus,title:"Google Plus"}).create("span",{"class":"icon icon-google-plus"}),t.twitter.isEmpty()||s.create("li").create("a",{"class":"twitter",href:"http://twitter.com/"+t.twitter,title:"Twitter"}).create("span",{"class":"icon icon-twitter"}),t.linkedin.isEmpty()||s.create("li").create("a",{"class":"linkedin",href:t.linkedin,title:"LinkedIn"}).create("span",{"class":"icon icon-linkedin"}),t.blog&&r.data.blog!==null&&s.create("li").create("a",{"class":"blog",href:r.data.blog,title:"Blog"}).create("span",{"class":"icon icon-rss"}),s.parentNode.removeClass("hidden"),a.el.destroy(),a=null,["events","orgs","repos"].forEach(function(e){try{i[e].data.restore()}catch(t){void 0}i[e].data.total>0&&l(e).then(function(){c(e)},function(e){u(e)}),h(e).then(function(){l(e).then(function(){c(e)},function(e){u(e)})},function(e){u(e)})})},function(e){a.el.destroy(),a=null,u("Could not retrieve GitHub account: "+e.message)})},function(e){u("Could not consume APIs")})},f=function(n,r){r=r===!0,e.log(n),r||t.log(n)},l=function(e){var t=("templates/"+e+".html").get(function(t){i.templates[e]=t},function(e){throw e});return t},c=function(t){var s=e("#"+t),u,a,f,l;u=function(e){var n=e.find(".moment"),r,s;n.forEach(function(e){e.text(moment(e.text()).fromNow())});switch(t){case"events":s=i[t].data.get(e.data("key").toString()),e.find("> span")[0].addClass(s.data.type),e.find("a")[0].attr("title",s.data.type.replace("Event","").replace(/([A-Z])/g," $1").trim());break;case"repos":s=i[t].data.get(e.data("key").toString()),r=e.find("> a")[0],e.find("> span")[0].addClass(s.data.fork?"icon-circle-blank forked":"icon-circle authored"),r.attr("href").isEmpty()&&r.attr("href",s.data.html_url)}};if(i[t].data.total>0){i[t].datalist===undefined&&(i[t].datalist=e.datalist(s,i[t].data,i.templates[t],{callback:u}),s.removeClass("hidden"));switch(t){case"events":a=[],f=d("pie",i[t].data.get(),t),l=e("#recent-activities").clear(),l.parentNode.find("h2").destroy(),f[0].forEach(function(e){a.push(n[r.index(e.key.replace(/\s+/g,"")+"Event")]||n.last())}),o("pie","Recent Activities",f,l,a);break;case"orgs":break;case"repos":l=e("#repositories").clear(),l.parentNode.find("h2").destroy(),o("pie","Repositories",d("pie",i[t].data.get(),t),l,["#009999","#9FEE00"])}}},h=function(e){var t=i[e].data.setUri(s[e]).then(function(t){if(t.length===1&&t[0].data.message!==undefined)throw Error(t[0].data.message);i[e].data.save()},function(e){throw e});return t},p=function(t,n){t=e.object(t),n=n||"small";var r,i;i={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#000",speed:1,trail:70,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};switch(n){case"small":i.length=4,i.radius=4,i.width=2;break;case"medium":i.length=7,i.radius=7,i.width=3;break;case"large":default:i.length=12,i.radius=12,i.width=3}return(new Spinner(i)).spin(t)},d=function(t,n,r){var i=[],s=[],o={},u=n.length;switch(t){case"pie":r==="events"?(n.forEach(function(e){var t=e.data.type;o[t]=o[t]+1||1}),e.iterate(o,function(e,t){s.push({key:t.replace("Event","").replace(/([A-Z])/g," $1").trim(),y:e/u*100})})):r==="repos"&&(n.forEach(function(e){var t=e.data.fork?"Forked":"Authored";o[t]=o[t]+1||1}),s.push({key:"Authored",y:o.Authored/u*100}),s.push({key:"Forked",y:o.Forked/u*100})),i=[s]}return i};e.on("render",function(){a()})})(abaaso,humane);