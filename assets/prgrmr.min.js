/**
 * prgrmr
 *
 * Single page JavaScript dashboard of a Programmer's activity on GitHub
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright 2013 Jason Mulligan
 * @license BSD-3 <https://raw.github.com/avoidwork/prgrmr/master/LICENSE>
 * @link https://github.com/avoidwork/prgrmr
 * @version 0.1.3
 */
(function(e){"use strict";var t,n=["#FF0000","#FF7400","#009999","#00CC00","#FFF141","#A1F73F","#FFBB00","#A7A500","#7B005D","#450070","#5F15F6","#EA0043","#2AF000","#41D988","#3FA9CD","#046889","#F09C45","#7BB000"],r=["CommitCommentEvent","CreateEvent","DeleteEvent","DownloadEvent","FollowEvent","ForkEvent","ForkApplyEvent","GistEvent","GollumEvent","IssueCommentEvent","IssuesEvent","MemberEvent","PublicEvent","PullRequestEvent","PullRequestReviewCommentEvent","PushEvent","TeamAddEvent","WatchEvent"],i={blog:{},config:{},events:{},orgs:{},repos:{},templates:{},version:"0.1.3"},s={events:"https://api.github.com/users/{{user}}/events?callback=?",orgs:"https://api.github.com/users/{{user}}/orgs?callback=?",repos:"https://api.github.com/users/{{user}}/repos?callback=?"},o=function(e,n,r,i,s){s=s||d3.scale.category10().range();var o=i.id,u;t("#charts").removeClass("hidden"),i.parentNode.prepend("h2").text(n);switch(e){case"pie":u=function(){var e=nv.models.pieChart().x(function(e){return e.key}).y(function(e){return e.y}).values(function(e){return e}).tooltipContent(function(e,t,n,r){return"<h3>"+e+"</h3>"+"<span>"+t+"%</span>"}).color(s).showLabels(!1);return d3.select("#"+o).datum(r).transition().duration(1200).call(e),e}}return nv.addGraph(u)},u=function(n){var r=n.message||n;t.log(r,"error"),e.humane.error(r)},a=function(){var n=t("#contact"),r=t("header > h1")[0],o=t("title")[0],a=t("#version"),f=t("article")[0],l;e.humane.error=e.humane.spawn({addnCls:"humane-jackedup-error",timeout:3e3}),a!=="undefined"&&a.html(i.version),l=p(f,"large"),"assets/config.json".get(function(e){if(e.github.isEmpty())throw Error(t.label.error.invalidArguments);i.config=e,e.name.isEmpty()||(r.html(e.name),o.html(e.name)),n.create("li").create("a",{"class":"github",href:"https://github.com/"+e.github,title:"GitHub"}).create("span",{"class":"icon icon-github"}),e.email.isEmail()&&n.create("li").create("a",{"class":"email",href:"mailto:"+e.email,title:"Email"}).create("span",{"class":"icon icon-envelope-alt"}),e.twitter.isEmpty()||n.create("li").create("a",{"class":"twitter",href:"http://twitter.com/"+e.twitter,title:"Twitter"}).create("span",{"class":"icon icon-twitter"}),e.linkedin.isEmpty()||n.create("li").create("a",{"class":"linkedin",href:e.blog,title:"LinkedIn"}).create("span",{"class":"icon icon-linkedin"}),e.blog.isEmpty()||n.create("li").create("a",{"class":"blog",href:e.blog,title:"Blog"}).create("span",{"class":"icon icon-rss"}),n.childNodes.length>0&&n.parentNode.removeClass("hidden")},function(e){throw l.el.destroy(),l=null,u(e),e}).then(function(n){t.iterate(s,function(e,t){s[t]=e.replace("{{user}}",n.github)}),t.iterate(i,function(e,n){this[n]=t.data({id:n},null,{key:"id",events:!1,callback:"callback",source:"data"})}),e.prgrmr=i},function(e){throw l.el.destroy(),l=null,u("Configuration is not valid: "+(e.message||e)),e}).then(function(e){h("events",l),h("orgs",l),h("repos",l,c)},function(e){l.el.destroy(),l=null,u("Could not consume APIs")})},f=function(e,n){n=n===!0,t.log(e),n||humane.log(e)},l=function(e){var s=t("#"+e),u,a,f;u=function(t){var n=t.find(".moment"),r,s;n.forEach(function(e){e.text(moment(e.text()).fromNow())});switch(e){case"events":s=i[e].data.get(t.data("key").toString()),t.find("> span")[0].addClass(s.data.type),t.find("a")[0].attr("title",s.data.type.replace("Event","").replace(/([A-Z])/g," $1").trim());break;case"repos":s=i[e].data.get(t.data("key").toString()),r=t.find("> a")[0],t.find("> span")[0].addClass(s.data.fork?"icon-circle-blank forked":"icon-circle authored"),r.attr("href").isEmpty()&&r.attr("href",s.data.html_url)}},i[e].datalist=t.datalist(s,i[e].data,i.templates[e],{callback:u}),s.removeClass("hidden");switch(e){case"events":a=[],f=d("pie",i[e].data.get(),e),f[0].forEach(function(e){a.push(n[r.index(e.key+"Event")]||n.last())}),o("pie","Recent Activities",f,t("#recent-activities"),a);break;case"orgs":break;case"repos":o("pie","Repositories",d("pie",i[e].data.get(),e),t("#repositories"),["#009999","#9FEE00"])}},c=function(e){void 0},h=function(e,n,r){var o=t.promise();return i[e].data.setUri(s[e]).then(function(t){if(t.length===1&&t[0].data.message!==undefined)return n!==null&&(n.el.destroy(),n=null),u(t[0].data.message);("templates/"+e+".html").get(function(s){i.templates[e]=s,n!==null&&(n.el.destroy(),n=null),l(e),i[e].data.setExpires(6e5),typeof r=="function"&&r(t),o.resolve(!0)},function(e){o.reject(e),u(e)})},function(e){n!==null&&(n.el.destroy(),n=null),o.reject(e),u(e)}),o},p=function(e,n){e=t.object(e),n=n||"small";var r,i;i={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#000",speed:1,trail:70,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};switch(n){case"small":i.length=4,i.radius=4,i.width=2;break;case"medium":i.length=7,i.radius=7,i.width=3;break;case"large":default:i.length=12,i.radius=12,i.width=3}return(new Spinner(i)).spin(e)},d=function(e,n,r){var i=[],s=[],o={},u=0;switch(e){case"pie":r==="events"?(n.forEach(function(e){var t=e.data.type;o[t]=o[t]+1||1,u++}),t.iterate(o,function(e,t){s.push({key:t.replace("Event","").replace(/([A-Z])/g," $1").trim(),y:e/u*100})})):r==="repos"&&(n.forEach(function(e){var t=e.data.fork?"Forked":"Authored";o[t]=o[t]+1||1,u++}),t.iterate(o,function(e,t){s.push({key:t,y:e/u*100})})),i=[s]}return i};typeof abaaso!="undefined"&&(t=e[abaaso.aliased],t.on("render",function(){a()}))})(this);