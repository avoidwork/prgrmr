/**
 * prgrmr
 *
 * Single page JavaScript dashboard of a Programmer's activity on GitHub
 *
 * @author Jason Mulligan <jason.mulligan@avoidwork.com>
 * @copyright 2013 Jason Mulligan
 * @license BSD-3 <https://raw.github.com/avoidwork/prgrmr/master/LICENSE>
 * @link https://github.com/avoidwork/prgrmr
 * @version 0.1.12
 */
(function(e){"use strict";var t,n=["#FF0000","#FF7400","#009999","#00CC00","#FFF141","#A1F73F","#FFBB00","#A7A500","#7B005D","#450070","#5F15F6","#EA0043","#2AF000","#41D988","#3FA9CD","#046889","#F09C45","#7BB000"],r=["CommitCommentEvent","CreateEvent","DeleteEvent","DownloadEvent","FollowEvent","ForkEvent","ForkApplyEvent","GistEvent","GollumEvent","IssueCommentEvent","IssuesEvent","MemberEvent","PublicEvent","PullRequestEvent","PullRequestReviewCommentEvent","PushEvent","TeamAddEvent","WatchEvent"],i={config:{},events:{},orgs:{},repos:{},me:{},templates:{},version:"0.1.12"},s={events:"https://api.github.com/users/{{user}}/events?callback=?",me:"https://api.github.com/users/{{user}}?callback=?",orgs:"https://api.github.com/users/{{user}}/orgs?callback=?",repos:"https://api.github.com/users/{{user}}/repos?callback=?"},o=function(e,n,r,i,s){s=s||d3.scale.category10().range();var o=i.id,u;t("#charts").removeClass("hidden"),i.parentNode.prepend("h2").text(n);switch(e){case"pie":u=function(){var e=nv.models.pieChart().x(function(e){return e.key}).y(function(e){return e.y}).values(function(e){return e}).tooltipContent(function(e,t,n,r){return"<h3>"+e+"</h3>"+"<span>"+t+"%</span>"}).color(s).showLabels(!1);return d3.select("#"+o).datum(r).transition().duration(1200).call(e),e}}return nv.addGraph(u)},u=function(n){var r=n.message||n;t.log(r,"error"),e.humane.error(r)},a=function(){var n=t("#version"),r=t("article")[0],o={key:"id",events:!1,callback:"callback",source:"data"},a;e.humane.error=e.humane.spawn({addnCls:"humane-jackedup-error",timeout:3e3}),n!=="undefined"&&n.html(i.version),a=p(r,"large"),"assets/config.json".get(function(e){if(e.github.isEmpty())throw Error(t.label.error.invalidArguments);i.config=e},function(e){throw a.el.destroy(),a=null,u(e),e}).then(function(n){t.iterate(s,function(e,r){s[r]=e.replace("{{user}}",n.github),i[r]=t.data({id:r},null,o)}),e.prgrmr=i},function(e){throw a!==null&&(a.el.destroy(),a=null),u("Configuration is not valid: "+(e.message||e)),e}).then(function(e){h("me").then(function(n){var r=n[0],s=t("#contact"),o=t("header > h1")[0],f=t("title")[0];e.name&&(o.html(r.data.name),f.html(r.data.name)),s.create("li").create("a",{"class":"github",href:"https://github.com/"+e.github,title:"GitHub"}).create("span",{"class":"icon icon-github"}),e.email&&r.data.email!==null&&s.create("li").create("a",{"class":"email",href:"mailto:"+r.data.email,title:"Email"}).create("span",{"class":"icon icon-envelope-alt"}),e.gplus.isEmpty()||s.create("li").create("a",{"class":"gplus",href:"https://plus.google.com/"+e.gplus,title:"Google Plus"}).create("span",{"class":"icon icon-google-plus"}),e.twitter.isEmpty()||s.create("li").create("a",{"class":"twitter",href:"http://twitter.com/"+e.twitter,title:"Twitter"}).create("span",{"class":"icon icon-twitter"}),e.linkedin.isEmpty()||s.create("li").create("a",{"class":"linkedin",href:e.linkedin,title:"LinkedIn"}).create("span",{"class":"icon icon-linkedin"}),e.blog&&r.data.blog!==null&&s.create("li").create("a",{"class":"blog",href:r.data.blog,title:"Blog"}).create("span",{"class":"icon icon-rss"}),s.parentNode.removeClass("hidden"),a.el.destroy(),a=null,["events","orgs","repos"].forEach(function(e){try{i[e].data.restore()}catch(t){void 0}i[e].data.total>0&&l(e).then(function(){c(e)},function(e){u(e)}),h(e).then(function(){l(e).then(function(){c(e)},function(e){u(e)})},function(e){u(e)})})},function(e){a.el.destroy(),a=null,u("Could not retrieve GitHub account: "+e.message)})},function(e){u("Could not consume APIs")})},f=function(e,n){n=n===!0,t.log(e),n||humane.log(e)},l=function(e){var t=("templates/"+e+".html").get(function(t){i.templates[e]=t},function(e){throw e});return t},c=function(e){var s=t("#"+e),u,a,f,l;u=function(t){var n=t.find(".moment"),r,s;n.forEach(function(e){e.text(moment(e.text()).fromNow())});switch(e){case"events":s=i[e].data.get(t.data("key").toString()),t.find("> span")[0].addClass(s.data.type),t.find("a")[0].attr("title",s.data.type.replace("Event","").replace(/([A-Z])/g," $1").trim());break;case"repos":s=i[e].data.get(t.data("key").toString()),r=t.find("> a")[0],t.find("> span")[0].addClass(s.data.fork?"icon-circle-blank forked":"icon-circle authored"),r.attr("href").isEmpty()&&r.attr("href",s.data.html_url)}};if(i[e].data.total>0){i[e].datalist===undefined&&(i[e].datalist=t.datalist(s,i[e].data,i.templates[e],{callback:u}),s.removeClass("hidden"));switch(e){case"events":a=[],f=d("pie",i[e].data.get(),e),l=t("#recent-activities").clear(),l.parentNode.find("h2").destroy(),f[0].forEach(function(e){a.push(n[r.index(e.key.replace(/\s+/g,"")+"Event")]||n.last())}),o("pie","Recent Activities",f,l,a);break;case"orgs":break;case"repos":l=t("#repositories").clear(),l.parentNode.find("h2").destroy(),o("pie","Repositories",d("pie",i[e].data.get(),e),l,["#009999","#9FEE00"])}}},h=function(e){var t=i[e].data.setUri(s[e]).then(function(t){if(t.length===1&&t[0].data.message!==undefined)throw Error(t[0].data.message);i[e].data.save()},function(e){throw e});return t},p=function(e,n){e=t.object(e),n=n||"small";var r,i;i={lines:13,length:5,width:2,radius:5,corners:1,rotate:0,color:"#000",speed:1,trail:70,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};switch(n){case"small":i.length=4,i.radius=4,i.width=2;break;case"medium":i.length=7,i.radius=7,i.width=3;break;case"large":default:i.length=12,i.radius=12,i.width=3}return(new Spinner(i)).spin(e)},d=function(e,n,r){var i=[],s=[],o={},u=n.length;switch(e){case"pie":r==="events"?(n.forEach(function(e){var t=e.data.type;o[t]=o[t]+1||1}),t.iterate(o,function(e,t){s.push({key:t.replace("Event","").replace(/([A-Z])/g," $1").trim(),y:e/u*100})})):r==="repos"&&(n.forEach(function(e){var t=e.data.fork?"Forked":"Authored";o[t]=o[t]+1||1}),s.push({key:"Authored",y:o.Authored/u*100}),s.push({key:"Forked",y:o.Forked/u*100})),i=[s]}return i};typeof abaaso!="undefined"&&(t=e[abaaso.aliased],t.on("render",function(){a()}))})(this);